# tg-archiver Environment Configuration
# Copy this to .env and fill in your values

# =============================================================================
# TELEGRAM CREDENTIALS (Required)
# =============================================================================
# Get these from https://my.telegram.org/apps
TELEGRAM_API_ID=your_api_id_here
TELEGRAM_API_HASH=your_api_hash_here
TELEGRAM_SESSION_NAME=listener

# =============================================================================
# DATABASE
# =============================================================================
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=tg_archiver
POSTGRES_USER=archiver
POSTGRES_PASSWORD=change_me_in_production

# =============================================================================
# OBJECT STORAGE (MinIO)
# =============================================================================
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin_change_me_at_least_32_chars
MINIO_BUCKET_NAME=tg-archive-media
MINIO_SECURE=false

# =============================================================================
# REDIS
# =============================================================================
REDIS_URL=redis://redis:6379
# Redis password for production security (empty = no auth in development)
# Generate with: openssl rand -base64 32
REDIS_PASSWORD=

# =============================================================================
# API SECRET KEY
# =============================================================================
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
SECRET_KEY=change_me_in_production

# =============================================================================
# AUTHENTICATION
# =============================================================================
# Auth provider: "none" (no auth) or "jwt" (JWT with local users)
AUTH_PROVIDER=jwt

# JWT Configuration (required when AUTH_PROVIDER=jwt)
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
JWT_SECRET_KEY=change_me_generate_64_char_secret_key_here
JWT_ADMIN_EMAIL=admin@tg-archiver.local
JWT_ADMIN_PASSWORD=change_me_in_production
JWT_EXPIRATION_MINUTES=60

# =============================================================================
# TRANSLATION (Optional)
# =============================================================================
# Enable to translate non-English messages to English
TRANSLATION_ENABLED=true
# DeepL API key (optional - uses Google Translate free tier if not set)
# Get API key from https://www.deepl.com/pro-api
DEEPL_API_KEY=

# =============================================================================
# FOLDER-BASED CHANNEL MANAGEMENT
# =============================================================================
# Telegram folder name pattern for channels to archive
# Create a folder in Telegram with this name and add channels to it
# Max 12 characters due to Telegram folder name limit
FOLDER_ARCHIVE_ALL_PATTERN=tg-archiver

# =============================================================================
# BACKFILL CONFIGURATION
# =============================================================================
# Enable backfill of historical messages
BACKFILL_ENABLED=true
# Start date for backfill (ISO format: YYYY-MM-DD)
BACKFILL_START_DATE=2024-01-01
# Mode: manual, on_discovery (auto-backfill new channels), scheduled
BACKFILL_MODE=on_discovery
# Messages per batch (rate-limit friendly)
BACKFILL_BATCH_SIZE=100
# Delay between batches in milliseconds
BACKFILL_DELAY_MS=1000
# Media handling: download_available, skip, download_all
BACKFILL_MEDIA_STRATEGY=download_available

# =============================================================================
# SOCIAL DATA FETCHING (Comments & Reactions)
# =============================================================================
# Fetch comments from discussion groups and reactions from messages.
# Uses Telegram API: GetDiscussionMessage, GetMessagesReactions
# Data displayed in the Social Graph tab of message detail view.

# Enable/disable social data fetching entirely
SOCIAL_FETCH_ENABLED=true

# Only fetch social data for messages from the last N days
# Older messages won't have their comments/reactions updated
SOCIAL_FETCH_PERIOD_DAYS=7

# How often to run the fetch cycle (in seconds)
# Each cycle processes SOCIAL_FETCH_BATCH_SIZE messages
SOCIAL_FETCH_INTERVAL_SECONDS=300

# Number of messages to process per fetch cycle
# Higher = more API calls, lower = slower catch-up
SOCIAL_FETCH_BATCH_SIZE=50

# =============================================================================
# GAP DETECTION (fills gaps from downtime)
# =============================================================================
GAP_DETECTION_ENABLED=true
GAP_LOOKBACK_HOURS=24

# =============================================================================
# FRONTEND
# =============================================================================
# API URL for client-side requests
# - Empty string: Use relative URLs (when behind Caddy/nginx proxy)
# - http://localhost:8000: Direct API access (development without proxy)
NEXT_PUBLIC_API_URL=

# =============================================================================
# OPTIONAL FEATURES
# =============================================================================
# Enable external RSS news ingestion feature
# When true: Shows News page, admin RSS feeds management, immersive RSS ticker
# When false: Hides all external RSS news features (native RSS output still works)
NEXT_PUBLIC_RSS_ENABLED=false

# =============================================================================
# SECURITY (Production)
# =============================================================================
# Environment mode: "development" or "production"
# Affects: cookie secure flag, HTTPS enforcement
ENVIRONMENT=development

# CSRF protection (double-submit cookie pattern)
# Enable in production. Requires frontend to send X-CSRF-Token header.
CSRF_ENABLED=false

# Token blacklist behavior when Redis is unavailable
# "open" = allow requests (availability over security)
# "closed" = deny requests (security over availability)
TOKEN_BLACKLIST_FAIL_MODE=open
